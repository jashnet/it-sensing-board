name: ğŸŒ… Daily Morning Sensing Batch

on:
  schedule:
    # í•œêµ­ ì‹œê°„ ê¸°ì¤€ ë§¤ì¼ ì•„ì¹¨ 7ì‹œ (UTC ì‹œê°„ìœ¼ë¡œëŠ” ë°¤ 10ì‹œ)ì— ìë™ ì‹¤í–‰
    - cron: '0 22 * * *'
  workflow_dispatch: # ìˆ˜ë™ìœ¼ë¡œë„ ë²„íŠ¼ì„ ëˆŒëŸ¬ ëŒë¦´ ìˆ˜ ìˆê²Œ í•¨

jobs:
  run-batch:
    runs-on: ubuntu-latest
    steps:
      - name: ì €ì¥ì†Œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # ğŸ’¡ [ì§„ì§œ í•µì‹¬] ê³¼ê±° ê¸°ë¡ê¹Œì§€ ëª¨ë‘ ê°€ì ¸ì™€ì„œ ë³‘í•© ì¶©ëŒ ë°©ì§€
          ref: main       # ğŸ’¡ [ì§„ì§œ í•µì‹¬] í—ˆê³µì´ ì•„ë‹ˆë¼ ì •í™•íˆ main ë¸Œëœì¹˜ë¥¼ íƒ€ê²ŸíŒ…

      - name: íŒŒì´ì¬ í™˜ê²½ ì„¤ì •
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
        run: |
          pip install feedparser google-genai beautifulsoup4 deep-translator

      - name: ëª¨ë‹ ì„¼ì‹± ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ (batch.py)
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: python batch.py

      - name: ìˆ˜ì§‘ëœ ê²°ê³¼(JSON)ë¥¼ Githubì— ë®ì–´ì“°ê¸° ì €ì¥
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          
          # Git ë³‘í•© ë°©ì‹ì„ 'ì¼ë°˜ ë³‘í•©'ìœ¼ë¡œ ê¸°ë³¸ ì„¤ì • (ê²½ê³  ë©”ì‹œì§€ ë°©ì§€)
          git config pull.rebase false
          
          git add today_news.json || true
          git add archive/*.json || true
          git commit -m "ğŸ¤– [Automated] Update Morning Sensing Data" || echo "No changes to commit"
          
          # ğŸ’¡ [ì§„ì§œ ìµœì¢… ë¬´ì  ì½”ë“œ] ê¹ƒí—ˆë¸Œì— ë‹¤ë¥¸ íŒŒì¼ì´ ìˆë“  ë§ë“ , ì¶©ëŒì´ ë‚˜ë©´ ë¬´ì¡°ê±´ ì§€ê¸ˆ ë‚´ê°€ ë§Œë“  íŒŒì¼(ours)ë¡œ ê°•ì œ ë®ì–´ì“°ë©´ì„œ í•©ì³ë¼!
          git pull origin main -X ours --no-edit
          
          git push origin main
