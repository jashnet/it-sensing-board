name: ğŸŒ… Daily Morning Sensing Batch

on:
  schedule:
    # í•œêµ­ ì‹œê°„ ê¸°ì¤€ ë§¤ì¼ ì•„ì¹¨ 7ì‹œ (UTC ì‹œê°„ìœ¼ë¡œëŠ” ë°¤ 10ì‹œ)ì— ìë™ ì‹¤í–‰
    - cron: '0 22 * * *'
  workflow_dispatch: # ìˆ˜ë™ìœ¼ë¡œ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹¤í–‰

jobs:
  run-batch:
    runs-on: ubuntu-latest
    
    # ğŸ’¡ ë´‡ì´ ê¹ƒí—ˆë¸Œ ì €ì¥ì†Œì— íŒŒì¼ì„ ì“¸ ìˆ˜ ìˆë„ë¡ ëª…ì‹œì  ê¶Œí•œì„ ë¶€ì—¬í•©ë‹ˆë‹¤.
    permissions:
      contents: write

    steps:
      - name: ì €ì¥ì†Œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # ê³¼ê±° ê¸°ë¡ì„ ëª¨ë‘ ë¶ˆëŸ¬ì™€ ì¶©ëŒ ë°©ì§€

      - name: íŒŒì´ì¬ í™˜ê²½ ì„¤ì •
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
        run: |
          pip install feedparser google-genai beautifulsoup4 deep-translator

      - name: ëª¨ë‹ ì„¼ì‹± ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ (batch.py)
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: python batch.py

      - name: ìˆ˜ì§‘ëœ ê²°ê³¼(JSON)ë¥¼ Githubì— ë®ì–´ì“°ê¸° ì €ì¥
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          
          # Git ë³‘í•© ë°©ì‹ì„ ì„¤ì •í•˜ì—¬ ì—ëŸ¬ ë°©ì§€
          git config pull.rebase false
          
          # ìˆ˜ì§‘ëœ íŒŒì¼ì„ ì¥ë°”êµ¬ë‹ˆì— ë‹´ê¸° (íŒŒì¼ì´ ì—†ì–´ë„ ì—ëŸ¬ ë‚´ì§€ ì•Šê³  ë¬´ì‹œ)
          git add today_news.json || echo "No today_news.json to add"
          git add archive/*.json || echo "No archive files to add"
          
          # í¬ì¥í•˜ê¸°
          git commit -m "ğŸ¤– [Automated] Update Morning Sensing Data" || echo "No changes to commit"
          
          # í˜¹ì‹œ ëª¨ë¥¼ ì¶©ëŒì„ ëŒ€ë¹„í•´ ìµœì‹  ë²„ì „ì„ ë‚´ íŒŒì¼ë¡œ ê°•ì œ ë®ì–´ì“°ë©° í•©ì¹˜ê¸°
          git pull origin main -X ours --no-edit || true
          
          # ğŸ’¡ [ê°€ì¥ ì¤‘ìš”] ê¹ƒí—ˆë¸Œ ê³µì‹ í† í°ì„ ì‚¬ìš©í•˜ì—¬ ë¬´ì¡°ê±´ ê°•ì œ ì „ì†¡(Push)
          git push https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}.git HEAD:main
